<!DOCTYPE html>
<html>
<head>
  <title>Covergrid</title>
  <style>
    body {
      background-color: #f5f5f5;
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }

    .container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      grid-gap: 40px;
      padding: 10px;
      max-width: 100%;
      margin: 0 auto;
	  width: 750px;
    }

    .cover {
      position: relative;
      overflow: hidden;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.7);
      transition: transform 0.3s ease;
      margin: 0;
      padding: 0;
      border-radius: 10px; /* Ensure the cover wrapper has rounded corners */
    }

    .cover:hover {
      transform: translateY(-5px);
    }

    .cover img {
      height: 100%;
      width: 100%;
      object-fit: cover;
      object-position: center;
      display: block;
      margin: 0;
      border-radius: 10px; /* Ensure the cover has rounded corners */
    }
	
	.header-bar {
		display: flex;
		background-color: #f0f0f0;
		padding: 10px 0 0 0;
		width: 100%;
	}
	.header-wrapper {
		flex: 1;
		display: flex;
		align-items: center;
		justify-content: center;
	}
	.header-bar img {
		max-height: 100px;
	}
	label {
		margin-right: 10px;
	}
	input[type="range"] {
		margin-left: 10px;
	}
	
  </style>
</head>
<body>

    <div class="header-bar">
        <div class="header-wrapper">
            <label for="container-width">Container Width:</label>
            <input type="range" id="container-width" min="300" max="1200" value="750" />
        </div>
        <div class="header-wrapper">
			<img src="covergrid_logo.png" alt="Header Image" />
		</div>
        <div class="header-wrapper">
			<a href="https://github.com/kmfd/covergrid">https://github.com/kmfd/covergrid</a>
		</div>
    </div>
  <div class="container" id="covers"></div>

  <script>
    // Function to update the grid container width based on the slider value
    function updateContainerWidth(value) {
        const container = document.querySelector('.container');
        container.style.width = `${value}px`;
    }

    // Event listener for the slider
    document.getElementById('container-width').addEventListener('input', function () {
        updateContainerWidth(this.value);
    });

    function getCovers() {
        return fetch('get_covers.php')
        .then(response => {
            // Check if the response is OK (status in the range 200-299)
            if (!response.ok) {
                console.warn("Error: Resource not found or other error occurred. Status:", response.status);
                return []; // Return an empty array if the resource is not found
            }
            return response.text(); // Read the response as text first
        })
        .then(text => {
            try {
                return JSON.parse(text); // Attempt to parse the text as JSON
            } catch (error) {
                console.warn("Failed to parse JSON:", error);
                return []; // Return an empty array if JSON parsing fails
            }
        })
        .catch(error => {
            console.error("Fetch error:", error);
            return []; // Return an empty array on fetch error
        });
    }

    // Fetch covers from the server
    getCovers()
    .then(covers => {
        const container = document.getElementById('covers');

        // Check if there are no images from the covers directory
        if (covers.length === 0) {
            // If no images found, include no-cover.png from the root directory
            const noCoverElement = document.createElement('div');
            noCoverElement.classList.add('cover');

            const img = document.createElement('img');
            img.src = 'no-cover.png';
            img.alt = 'no-cover.png';

            noCoverElement.appendChild(img);
            container.appendChild(noCoverElement);
            covers.push('no-cover.png'); // Add to the array
        } else {
            // Iterate over the covers array and create elements for each cover
            covers.forEach(cover => {
                const bookCover = document.createElement('div');
                bookCover.classList.add('cover');

                const img = document.createElement('img');
                img.src = `covers/${cover}`;
                img.alt = cover;

                bookCover.appendChild(img);
                container.appendChild(bookCover);
            });
        }

        // Add dragover event to the document
        document.addEventListener('dragover', event => {
            event.preventDefault(); // Prevent default to allow drop
        });

        // Add drop event to the document
        document.addEventListener('drop', event => {
            event.preventDefault(); // Prevent default behavior

            const files = event.dataTransfer.files;

            // Remove no-cover.png if present
            const noCoverIndex = covers.indexOf('no-cover.png');
            if (noCoverIndex !== -1) {
                covers.splice(noCoverIndex, 1);
                const noCoverElement = Array.from(container.children).find(child => child.querySelector('img').alt === 'no-cover.png');
                if (noCoverElement) {
                    container.removeChild(noCoverElement);
                }
            }

            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = () => {
                    const bookCover = document.createElement('div');
                    bookCover.classList.add('cover');

                    const img = document.createElement('img');
                    img.src = reader.result;
                    img.alt = file.name;

                    bookCover.appendChild(img);
                    container.appendChild(bookCover);
                };
                reader.readAsDataURL(file);
            });
        });
    })
    .catch(error => console.error(error));
  </script>
</body>
</html>
